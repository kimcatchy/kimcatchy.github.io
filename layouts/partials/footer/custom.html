<!-- Back to Top Button -->
<a href="#" id="back-to-top" title="Back to top"></a>

<!-- Back to Top Button Styles -->
<style>
#back-to-top {
    display: none;
    position: fixed;
    bottom: 5px;
    right: 15px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--body-background);
    box-shadow: var(--shadow-l2);
    font-size: 20px;
    text-align: center;
    line-height: 38px;
    cursor: pointer;
    transition: transform 0.3s ease, background-color 0.3s ease;
    z-index: 999;
}

#back-to-top:before {
    content: "";
    display: inline-block;
    position: relative;
    transform: rotate(135deg);
    height: 8px;
    width: 8px;
    border-width: 0 0 2px 2px;
    border-color: var(--accent-color);
    border-style: solid;
}

#back-to-top:hover {
    transform: scale(1.1);
    background-color: var(--accent-background);
}

/* 반응형 스타일 */
@media screen and (max-width: 768px) {
    #back-to-top {
        bottom: 5px;
        right: var(--container-padding);
        width: 30px;
        height: 30px;
        font-size: 16px;
        line-height: 32px;
    }
}
</style>

<!-- Back to Top + NProgress JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Back to Top 기능
    const backToTopBtn = document.getElementById('back-to-top');
    
    function backToTop() {
        document.documentElement.scrollIntoView({
            behavior: 'smooth'
        });
    }
    
    function updateBackToTopVisibility() {
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        if (scrollTop > 200) {
            backToTopBtn.style.display = 'inline';
        } else {
            backToTopBtn.style.display = 'none';
        }
    }
    
    // 이벤트 리스너는 한 번만 등록
    if (backToTopBtn) {
        backToTopBtn.addEventListener('click', function(e) {
            e.preventDefault();
            backToTop();
        });
        
        window.addEventListener('scroll', updateBackToTopVisibility);
        updateBackToTopVisibility(); // 초기 상태 설정
    }
});

<!-- NProgress (개선된 버전) -->
(function() {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js';
    script.integrity = 'sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg';
    script.crossOrigin = 'anonymous';
    
    script.onload = function() {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css';
        link.integrity = 'sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE';
        link.crossOrigin = 'anonymous';
        document.head.appendChild(link);
        
        if (typeof NProgress !== 'undefined') {
            let progressStarted = false;
            let progressCompleted = false;
            
            function startProgress() {
                if (!progressStarted) {
                    NProgress.start();
                    progressStarted = true;
                    progressCompleted = false;
                }
            }
            
            function completeProgress() {
                if (progressStarted && !progressCompleted) {
                    NProgress.done();
                    progressCompleted = true;
                    progressStarted = false;
                }
            }
            
            // 즉시 시작
            if (document.readyState === 'loading') {
                startProgress();
            }
            
            // 다양한 완료 조건 체크
            function checkAndComplete() {
                if (document.readyState === 'complete') {
                    completeProgress();
                    return true;
                }
                return false;
            }
            
            // readyState 변경 감지
            document.addEventListener('readystatechange', function() {
                if (document.readyState === 'interactive') {
                    if (progressStarted) NProgress.inc(0.8);
                } else if (document.readyState === 'complete') {
                    setTimeout(completeProgress, 100); // 약간의 지연
                }
            });
            
            // 추가 완료 조건들
            window.addEventListener('load', function() {
                setTimeout(completeProgress, 200);
            });
            
            // 강제 완료 타이머 (백업)
            setTimeout(function() {
                if (!progressCompleted) {
                    console.log('NProgress 강제 완료');
                    completeProgress();
                }
            }, 10000); // 10초 후 강제 완료
            
            // 페이지가 이미 로드된 경우
            if (document.readyState === 'complete') {
                setTimeout(completeProgress, 100);
            }
        }
    };
    
    document.head.appendChild(script);
})();
</script>
